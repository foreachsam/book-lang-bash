<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html class="no-js">
<!--<![endif]-->
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">

<title>trap - GNU Bash 學習筆記</title>


<link rel="canonical" href="https://foreachsam.github.io/book-lang-bash/book/content/help/trap/">


<meta name="author" content="foreachsam">


<meta property="og:url" content="https://foreachsam.github.io/book-lang-bash/book/content/help/trap/">
<meta property="og:title" content="trap - GNU Bash 學習筆記">

<meta name="apple-mobile-web-app-title" content="trap - GNU Bash 學習筆記">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  
<link rel="shortcut icon" type="image/x-icon" href="../../../../../../assets/images/favicon.ico">
<link rel="icon" type="image/x-icon" href="../../../../../../assets/images/favicon.ico">
<style>
	@font-face {
		font-family: 'Icon';
		src: url('../../../assets/fonts/icon.eot?52m981');
		src: url('../../../assets/fonts/icon.eot?#iefix52m981') format('embedded-opentype'),
		url('../../../assets/fonts/icon.woff?52m981') format('woff'),
		url('../../../assets/fonts/icon.ttf?52m981') format('truetype'),
		url('../../../assets/fonts/icon.svg?52m981#icon') format('svg');
		font-weight: normal;
		font-style: normal;
	}
</style>
<link rel="stylesheet" href="../../../assets/stylesheets/application-0dac3e5884.css"> 
<link rel="stylesheet" href="../../../assets/stylesheets/palettes-05ab2406df.css">     
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono">
<style>
	body,
	input {
		font-family: 'Roboto',
		Helvetica,
		Arial,
		sans-serif;
	}

	pre,
	code {
		font-family: 'Roboto Mono',
		'Courier New',
		'Courier',
		monospace;
	}
</style>
 
<script src="../../../assets/javascripts/modernizr-4ab42b99fd.js"></script>


</head>


  

<body class="palette-primary-pink palette-accent-light-pink">
	
	<div class="backdrop">
		<div class="backdrop-paper"></div>
	</div>
	<input class="toggle" type="checkbox" id="toggle-drawer">
	<input class="toggle" type="checkbox" id="toggle-search">
	<label class="toggle-button overlay" for="toggle-drawer"></label>
	<header class="header">
		<nav aria-label="Header">
	<div class="bar default">
		<div class="button button-menu" role="button" aria-label="Menu">
			<label class="toggle-button icon icon-menu" for="toggle-drawer">
				<span></span>
			</label>
		</div>
		<div class="stretch">
			<div class="title">
				
				<span class="path">
            
              
                help <i class="icon icon-link"></i>
              
            
          </span>  trap
			</div>
		</div>
		  
		<div class="button button-github" role="button" aria-label="GitHub">
			<a href="https://github.com/foreachsam/book-lang-bash" title="@foreachsam/book-lang-bash on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
		</div>
		
		<div class="button button-search" role="button" aria-label="Search">
			<label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
		</div>
	</div>
	<div class="bar search">
		<div class="button button-close" role="button" aria-label="Close">
			<label class="toggle-button icon icon-back" for="toggle-search"></label>
		</div>
		<div class="stretch">
			<div class="field">
				<input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
			</div>
		</div>
		<div class="button button-reset" role="button" aria-label="Search">
			<button class="toggle-button icon icon-close" id="reset-search"></button>
		</div>
	</div>
</nav>
	</header>
	<main class="main">
		
		<div class="drawer">
			<nav aria-label="Navigation">

	<a href="https://foreachsam.github.io/book-lang-bash/book" class="project" title="GNU Bash 學習筆記">
		<div class="banner">

			<div class="name">
				<strong>GNU Bash 學習筆記<span class="version"></span></strong>

			</div>
		</div>
	</a>
	<div class="scrollable">
		<div class="wrapper">

			<div class="toc">
				<ul>

	
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="首頁" href="../../.." itemprop="url">
			首頁
    	</a>
	</div>
	
</li>


	
<li>
	<span class="section">參考文件</span>
	<ul>
		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="manual" href="../../reference/manual/" itemprop="url">
			manual
    	</a>
	</div>
	
</li>


		
	</ul>
</li>


	
<li>
	<span class="section">deb package</span>
	<ul>
		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="index" href="../../deb-package/" itemprop="url">
			index
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="bash" href="../../deb-package/bash/" itemprop="url">
			bash
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="bash-doc" href="../../deb-package/bash-doc/" itemprop="url">
			bash-doc
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="bash-completion" href="../../deb-package/bash-completion/" itemprop="url">
			bash-completion
    	</a>
	</div>
	
</li>


		
	</ul>
</li>


	
<li>
	<span class="section">command</span>
	<ul>
		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="bash" href="../../command/bash/" itemprop="url">
			bash
    	</a>
	</div>
	
</li>


		
	</ul>
</li>


	
<li>
	<span class="section">help</span>
	<ul>
		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="index" href="../" itemprop="url">
			index
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title=":" href="../colon/" itemprop="url">
			:
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="true" href="../true/" itemprop="url">
			true
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="false" href="../false/" itemprop="url">
			false
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="echo" href="../echo/" itemprop="url">
			echo
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="exit" href="../exit/" itemprop="url">
			exit
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="return" href="../return/" itemprop="url">
			return
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="test" href="../test/" itemprop="url">
			test
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="[" href="../square_brackets/" itemprop="url">
			[
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="if" href="../if/" itemprop="url">
			if
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="for" href="../for/" itemprop="url">
			for
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="while" href="../while/" itemprop="url">
			while
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="current" title="trap" href="./" itemprop="url">
			trap
    	</a>
	</div>
	    
	<ul>
		
		<li class="anchor" >
			<div itemscope itemtype="http://schema.org/Article">
				<a title="type trap" href="#type-trap" >
                	type trap
				</a>
			</div>
		</li>
		
		<li class="anchor" >
			<div itemscope itemtype="http://schema.org/Article">
				<a title="help trap" href="#help-trap" >
                	help trap
				</a>
			</div>
		</li>
		
		<li class="anchor" >
			<div itemscope itemtype="http://schema.org/Article">
				<a title="範例001" href="#001" >
                	範例001
				</a>
			</div>
		</li>
		
		<li class="anchor" >
			<div itemscope itemtype="http://schema.org/Article">
				<a title="範例002" href="#002" >
                	範例002
				</a>
			</div>
		</li>
		
		<li class="anchor" >
			<div itemscope itemtype="http://schema.org/Article">
				<a title="範例003" href="#003" >
                	範例003
				</a>
			</div>
		</li>
		
		<li class="anchor" >
			<div itemscope itemtype="http://schema.org/Article">
				<a title="範例004" href="#004" >
                	範例004
				</a>
			</div>
		</li>
		
	</ul>
	 
</li>


		
	</ul>
</li>


	
<li>
	<span class="section">exit status</span>
	<ul>
		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="$?" href="../../subject/exit-status/special_parameters/" itemprop="url">
			$?
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="exit" href="../../subject/exit-status/exit/" itemprop="url">
			exit
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="return" href="../../subject/exit-status/return/" itemprop="url">
			return
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="test" href="../../subject/exit-status/test/" itemprop="url">
			test
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="if" href="../../subject/exit-status/if/" itemprop="url">
			if
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="doc" href="../../subject/exit-status/doc/" itemprop="url">
			doc
    	</a>
	</div>
	
</li>


		
	</ul>
</li>


	
<li>
	<span class="section">arguments</span>
	<ul>
		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="positional parameters" href="../../subject/arguments/positional_parameters/" itemprop="url">
			positional parameters
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="special parameters" href="../../subject/arguments/special_parameters/" itemprop="url">
			special parameters
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="set positional parameters" href="../../subject/arguments/set_positional_parameters/" itemprop="url">
			set positional parameters
    	</a>
	</div>
	
</li>


		

			
<li>
	<div itemscope itemtype="http://schema.org/Article">
		<a class="" title="--" href="../../subject/arguments/option_end_flag/" itemprop="url">
			--
    	</a>
	</div>
	
</li>


		
	</ul>
</li>


				</ul>

				<hr>
				<span class="section">The author</span>
				<ul>
	
					<li>
						<a href="https://foreachsam.github.io/" target="_blank" title="foreachsam">
                  			foreachsam
            			</a>
					</li>
	
				</ul>

			</div>
		</div>
	</div>
</nav>
		</div>
		<article class="article">
			<div class="wrapper">
				 <h1 id="shell-keyword-trap">Shell keyword 「trap」</h1>
<h2 id="type-trap">type trap</h2>
<p>執行</p>
<pre class="code"><code class="language-sh">$ type trap</code></pre>


<p>顯示</p>
<pre class="code"><code>trap is a shell builtin</code></pre>


<h2 id="help-trap">help trap</h2>
<p>執行</p>
<pre class="code"><code class="language-sh">$ help trap</code></pre>


<p>顯示</p>
<pre class="code"><code>trap: trap [-lp] [[arg] signal_spec ...]
    Trap signals and other events.

    Defines and activates handlers to be run when the shell receives signals
    or other conditions.

    ARG is a command to be read and executed when the shell receives the
    signal(s) SIGNAL_SPEC.  If ARG is absent (and a single SIGNAL_SPEC
    is supplied) or `-', each specified signal is reset to its original
    value.  If ARG is the null string each SIGNAL_SPEC is ignored by the
    shell and by the commands it invokes.

    If a SIGNAL_SPEC is EXIT (0) ARG is executed on exit from the shell.  If
    a SIGNAL_SPEC is DEBUG, ARG is executed before every simple command.  If
    a SIGNAL_SPEC is RETURN, ARG is executed each time a shell function or a
    script run by the . or source builtins finishes executing.  A SIGNAL_SPEC
    of ERR means to execute ARG each time a command's failure would cause the
    shell to exit when the -e option is enabled.

    If no arguments are supplied, trap prints the list of commands associated
    with each signal.

    Options:
      -l    print a list of signal names and their corresponding numbers
      -p    display the trap commands associated with each SIGNAL_SPEC

    Each SIGNAL_SPEC is either a signal name in &lt;signal.h&gt; or a signal number.
    Signal names are case insensitive and the SIG prefix is optional.  A
    signal may be sent to the shell with &quot;kill -signal $$&quot;.

    Exit Status:
    Returns success unless a SIGSPEC is invalid or an invalid option is given.</code></pre>


<h2 id="001">範例001</h2>
<p>執行</p>
<pre class="code"><code>$ trap -l</code></pre>


<p>顯示</p>
<pre class="code"><code>1) SIGHUP    2) SIGINT   3) SIGQUIT  4) SIGILL   5) SIGTRAP
6) SIGABRT   7) SIGBUS   8) SIGFPE   9) SIGKILL 10) SIGUSR1
11) SIGSEGV 12) SIGUSR2 13) SIGPIPE 14) SIGALRM 15) SIGTERM
16) SIGSTKFLT   17) SIGCHLD 18) SIGCONT 19) SIGSTOP 20) SIGTSTP
21) SIGTTIN 22) SIGTTOU 23) SIGURG  24) SIGXCPU 25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF 28) SIGWINCH    29) SIGIO   30) SIGPWR
31) SIGSYS  34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX</code></pre>


<p>或是執行</p>
<pre class="code"><code class="language-sh">$ kill -l</code></pre>


<h2 id="002">範例002</h2>
<p>執行</p>
<pre class="code"><code class="language-sh">$ trap -p</code></pre>


<p>顯示</p>
<pre class="code"><code>trap -- '' SIGTSTP
trap -- '' SIGTTIN
trap -- '' SIGTTOU</code></pre>


<h2 id="003">範例003</h2>
<p>signal.sh</p>
<pre class="code"><code class="language-sh">#!/usr/bin/env bash


trap &quot;echo got signal!&quot; SIGHUP SIGINT

while true; do

        date;

        sleep 1;

done</code></pre>


<p>設定可執行</p>
<pre class="code"><code class="language-sh">$ chmod u+x signal.sh</code></pre>


<p>執行</p>
<pre class="code"><code class="language-sh">$ ./signal.sh</code></pre>


<p>另外開啟一個Terminal</p>
<p>找到剛剛執行的pid</p>
<p>執行</p>
<pre class="code"><code class="language-sh">$ ps aux | grep signal.sh</code></pre>


<p>或是執行</p>
<pre class="code"><code class="language-sh">$ pgrep -f ./signal.sh</code></pre>


<p>可以找到pid，例如</p>
<pre class="code"><code>15060</code></pre>


<p>然後對這個process發送signal</p>
<p>執行</p>
<pre class="code"><code class="language-sh">$ kill -1 15060</code></pre>


<p>或是執行</p>
<pre class="code"><code class="language-sh">$ kill -2 15060</code></pre>


<p>就會在一開始執行 signal.sh 那個 Terminal</p>
<p>看到</p>
<pre class="code"><code>got signal!
Tue May 17 20:47:13 CST 20
...略...</code></pre>


<p>上面的的步驟，也可以直接改成執行下面的指令</p>
<p>執行</p>
<pre class="code"><code class="language-sh">$ pkill -1 -f ./signal.sh</code></pre>


<p>或是執行</p>
<pre class="code"><code class="language-sh">$ pkill -2 -f ./signal.sh</code></pre>


<p>然後執行下面的指令，把剛剛執行的「./signal.sh」關閉</p>
<p>執行</p>
<pre class="code"><code class="language-sh">$ pkill -9 -f ./signal.sh</code></pre>


<p>或是執行</p>
<pre class="code"><code>$ kill -9 15060</code></pre>


<h2 id="004">範例004</h2>
<p>server.sh</p>
<pre class="code"><code class="language-sh">#!/usr/bin/env bash

THE_SIG_HUP=0

handle_signal () {
        if [ $THE_SIG_HUP = 0 ]; then
                THE_SIG_HUP=1;
        else

                THE_SIG_HUP=0;
        fi

}

trap handle_signal SIGHUP

while true; do
        #echo $THE_SIG_HUP;
        if [ $THE_SIG_HUP = 1 ]; then
                echo 'idle';
        else
                date;
        fi

        sleep 1;

done</code></pre>


<p>設定為可執行</p>
<pre class="code"><code class="language-sh">$ chmod u+x server.sh</code></pre>


<p>執行</p>
<pre class="code"><code class="language-sh">$ ./server.sh</code></pre>


<p>顯示</p>
<pre class="code"><code>Tue May 17 20:56:44 CST 2016
Tue May 17 20:56:45 CST 2016
Tue May 17 20:56:46 CST 2016
Tue May 17 20:56:47 CST 2016</code></pre>


<p>然後執行</p>
<pre class="code"><code class="language-sh">$ pkill -1 -f ./server.sh</code></pre>


<p>就會顯示</p>
<pre class="code"><code>Tue May 17 20:56:48 CST 2016
idle
idle
...略...</code></pre>


<p>然後再執行</p>
<pre class="code"><code class="language-sh">$ pkill -1 -f ./server.sh</code></pre>


<p>就會改成</p>
<pre class="code"><code>idle
Tue May 17 20:58:30 CST 2016
Tue May 17 20:58:31 CST 2016
Tue May 17 20:58:32 CST 2016
...略...</code></pre>
				<aside class="copyright" role="note">
					 Copyright (c) foreachsam &ndash;  Documentation built with
					<a href="http://www.mkdocs.org" target="_blank">MkDocs</a> using the
					<a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a> theme.
				</aside>
				
				<footer class="footer">
					
<nav class="pagination" aria-label="Footer">
	<div class="previous">
		
		<a href="../while/" title="while">
			<span class="direction">
            上一頁
          </span>
			<div class="page">
				<div class="button button-previous" role="button" aria-label="Previous">
					<i class="icon icon-back"></i>
				</div>
				<div class="stretch">
					<div class="title">
						while
					</div>
				</div>
			</div>
		</a>
		
	</div>
	<div class="next">
		
		<a href="../../subject/exit-status/special_parameters/" title="$?">
			<span class="direction">
            下一頁
          </span>
			<div class="page">
				<div class="stretch">
					<div class="title">
						$?
					</div>
				</div>
				<div class="button button-next" role="button" aria-label="Next">
					<i class="icon icon-forward"></i>
				</div>
			</div>
		</a>
		
	</div>
</nav>

				</footer>
				
			</div>
		</article>
		<div class="results" role="status" aria-live="polite">
			<div class="scrollable">
				<div class="wrapper">
					<div class="meta"></div>
					<div class="list"></div>
				</div>
			</div>
		</div>
	</main>
	<script>
		var base_url = '../../..';
		var repo_id = '';
	</script>
	<script src="../../../assets/javascripts/application-997097ee0c.js"></script>
	


<script>
	(function(i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function() {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date();
		a = s.createElement(o),
			m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document,
		'script', '//www.google-analytics.com/analytics.js', 'ga');
	/* General initialization */
	ga('create', 'UA-56999876-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
	/* Track outbound links */
	var buttons = document.querySelectorAll('a');
	Array.prototype.map.call(buttons, function(item) {
		if (item.host != document.location.host) {
			item.addEventListener('click', function() {
				var action = item.getAttribute('data-action') || 'follow';
				ga('send', 'event', 'outbound', action, item.href);
			});
		}
	});
	/* Register handler to log search on blur */
	var query = document.querySelector('.query');
	query.addEventListener('blur', function() {
		if (this.value) {
			var path = document.location.pathname;
			ga('send', 'pageview', path + '?q=' + this.value);
		}
	});
</script>


</body>

</html>